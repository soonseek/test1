# 코드 사양 (Code Specification)

**Task ID**: task-1-1-4
**제목**: Next.js API Route 파일 생성 (/api/pokemon)

다음은 `Next.js 14+ App Router` 아키텍처와 `Prisma ORM`을 사용하여 포켓몬 목록 조회 API를 구현하기 위한 파일 사양입니다.

---

### 파일: src/app/api/pokemon/route.ts
---
설명: 포켓몬 목록 조회를 위한 API Route 핸들러 (GET Method)
- HTTP GET 요청을 처리하여 JSON 형식의 포켓몬 목록 반환
- URL 쿼리 파라미터(`offset`, `limit`)를 파싱 및 검증 (기본값 설정: offset=0, limit=20)
- `src/lib/api/pokemon.ts`의 `getPokemonList` 함수를 호출하여 데이터 획득
- 데이터 획득 실패 시 500 에러, 성공 시 200 OK와 함께 데이터 반환
- CORS 및 헤더 설정 (JSON 타입 명시)

### 파일: src/lib/api/pokemon.ts
---
설명: 포켓몬 데이터 비즈니스 로직 및 데이터 소스(PokeAPI/DB) 관리 모듈
- `getPokemonList(offset: number, limit: number)` 함수 export
- **캐싱 로직 (FR-005)**:
  - Prisma Client(`db`)를 통해 `PokemonCache` 테이블 조회 시도
  - 캐시 히트 시 DB 데이터 반환 (Cache-Aside Pattern)
  - 캐시 미스 시 PokeAPI(`https://pokeapi.co/api/v2/pokemon`) 호출 후 DB에 저장 후 반환
- PokeAPI 호출 시 `fetch`의 `next.revalidate` 옵션을 활용하거나 별도의 TTL 로직 적용
- 에러 발생 시 적절한 에러 객체를 던져 Route Handler가 처리할 수 있도록 함

### 파일: src/lib/db/prisma.ts
---
설명: Prisma Client 싱글톤 인스턴스 관리 (개발 환경에서의 Hot Reload 지원)
- 전역 변수 `globalForPrisma` 선언을 통해 Prisma Client 인스턴스 캐싱
- `prisma` 인스턴스 export
- 개발 모드(`process.env.NODE_ENV !== 'production'`)에서 중복 인스턴스 생성 방지

### 파일: prisma/schema.prisma
---
설명: 데이터베이스 스키마 정의 (PokeAPI 캐싱 테이블)
- `PokemonCache` 모델 정의
  - `id`: Int (PokeAPI의 포켓몬 ID, @id)
  - `name`: String
  - `types`: String (JSON 형태로 저장 예.g. "fire,flying")
  - `imageUrl`: String
  - `data`: Json (전체 원본 데이터 저장)
  - `updatedAt`: DateTime (@updatedAt) - TTL 계산용

### 파일: src/types/pokemon.ts
---
설명: 포켓몬 데이터의 타입 정의 (TypeScript)
- `PokemonListItem` 인터페이스 정의 (id, name, types, imageUrl 등)
- `PokemonListResponse` 인터페이스 정의 (results: PokemonListItem[], count, next, prev 등)
- API Route 및 Library 간의 타입 안전성 보장