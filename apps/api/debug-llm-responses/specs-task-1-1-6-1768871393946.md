# 코드 사양 (Code Specification)

**Task ID**: task-1-1-6
**제목**: DB 캐싱 로직 페칭 함수에 통합 (선택)
**작성자**: Next.js 14+ Full-Stack Architect

---

## 개요
이 사양은 `getPokemonList` 함수의 성능과 안정성을 높이기 위해 **Cache-Aside Pattern**을 구현합니다. Prisma Client를 통해 데이터베이스(`PokemonCache`)를 먼저 확인하고, 데이터가 없거나 유효하지 않을 경우에만 PokeAPI를 호출하여 데이터베이스에 저장하는 로직을 통합합니다.

---

### 파일: prisma/schema.prisma
---
설명: 데이터베이스 스키마 정의 (캐싱 테이블 추가)
- `PokemonCache` 모델 정의
- `id`: Int (PokeAPI의 포켓몬 ID 혹은 캐시 키, Primary Key)
- `data`: Json (API 응답 전체 데이터를 JSON 형태로 저장)
- `updatedAt`: DateTime (캐시 유효성 판단을 위한 타임스탬프, 자동 업데이트)

### 파일: src/lib/prisma.ts
---
설명: Prisma Client 싱글톤 인스턴스 생성 유틸리티
- 개발 환경에서 Hot Reload 시 발생하는 DB 연결 누수 방지
- 전역적으로 Prisma Client 인스턴스를 재사용하도록 export

### 파일: src/lib/api/pokemon.ts
---
설명: 포켓몬 데이터 페칭 및 캐싱 로직을 담당하는 핵심 모듈
- **함수**: `getPokemonList(offset: number, limit: number)`
- **로직 흐름**:
  1. `prisma.pokemonCache.findMany()`를 호출하여 요청된 범위(`offset` ~ `offset + limit`)의 캐시 데이터를 조회합니다.
  2. **캐시 히트 (Cache Hit)**:
     - 조회된 데이터가 요청한 개수(`limit`)와 일치하고, `updatedAt`이 특정 시간(예: 1시간) 이내인 경우, DB 데이터를 반환합니다.
  3. **캐시 미스 (Cache Miss)**:
     - 데이터가 없거나 유효기간이 지난 경우, PokeAPI(`fetch`)를 호출하여 데이터를 가져옵니다.
     - `prisma.pokemonCache.upsert()`를 사용하여 가져온 데이터를 DB에 저장하거나 업데이트합니다.
     - 가져온 데이터를 반환합니다.
- **타입**: `PokemonListResponse` 인터페이스 정의 및 반환

### 파일: src/types/pokemon.ts
---
설명: 포켓몬 데이터 관련 TypeScript 인터페이스 정의
- `PokemonListItem`: 개별 포켓몬의 기본 정보 (name, url)
- `PokemonListResponse`: API 응답 구조 (count, next, previous, results)
- `PokemonCacheData`: DB에 저장될 JSON 데이터의 형식 (선택 사항, 엄격한 타이핑 위해)

### 파일: src/app/page.tsx
---
설명: 메인 페이지 (Server Component)
- `getPokemonList` 함수를 호출하여 초기 데이터를 가져옵니다.
- 가져온 데이터를 기반으로 `PokemonGrid` 컴포넌트에 props를 전달합니다.
- 캐싱 로직이 적용되었으므로, 데이터 로딩 속도가 개선되어야 합니다.

### 파일: .env
---
설명: 환경 변수 설정
- `DATABASE_URL`: PostgreSQL 연결 문자열
- `NEXT_PUBLIC_POKEAPI_BASE_URL`: PokeAPI 기본 URL (선택 사항, 코드 내 하드코딩 허용 시 생략 가능)