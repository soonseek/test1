# 코드 사양 (Code Specification)

**Task ID**: task-1-1-3
**제목**: 데이터 변환 로직 구현 (DTO 매핑)
**작성자**: Next.js 14+ Full-Stack Architect

---

## 개요
이 사양은 PokeAPI의 원본 JSON 데이터를 클라이언트 UI(`PokemonList` 컴포넌트)에 최적화된 형태로 변환하는 계층을 정의합니다. API Route Handler 내부에서 호출되며, 데이터 필터링, 타입 안전성 보장, 및 불필요한 데이터 제거를 담당합니다.

---

### 파일: src/types/pokemon.ts
---
설명: 포켓몬 데이터의 도메인 모델 및 DTO 타입을 정의하는 TypeScript 파일입니다. 외부 API 응답 타입과 내부 사용 타입을 명확히 구분합니다.
- **PokeApiListItem**: PokeAPI `pokemon?limit=...` 응답의 `results` 항목 타입 정의 (name, url)
- **PokeApiDetail**: PokeAPI `pokemon/{id}` 상세 응답 타입 (sprites, types, stats 등 전체 정의)
- **PokemonListItem**: 클라이언트 목록 페이지에 사용할 최적화된 DTO 타입 (id, name, imageUrl, types)
- **PokemonDetailItem**: 클라이언트 상세 페이지에 사용할 최적화된 DTO 타입

### 파일: src/lib/mappers/pokemon.mapper.ts
---
설명: 데이터 변환 로직의 핵심 파일입니다. Raw JSON 데이터를 비즈니스 로직에 맞게 가공합니다. (Pure Function)
- **toPokemonListItem 함수**:
  - 입력: `PokeApiDetail` 객체
  - 처리: `sprites.front_default` 이미지 URL 추출, 타입 데이터 매핑, ID 파싱
  - 반환: `PokemonListItem` 객체
  - 예외 처리: 이미지가 없을 경우 대체(Placeholder) URL 반환 로직 포함
- **toPokemonDetailItem 함수**:
  - 입력: `PokeApiDetail` 객체
  - 처리: 능력치(stats), 타입, 키/몸무게 등 상세 정보 매핑
  - 반환: `PokemonDetailItem` 객체

### 파일: src/lib/api/pokemon.api.ts
---
설명: API Route Handler 또는 Server Component에서 호출하는 비즈니스 로직 레이어입니다. 데이터 페칭과 변환을 조합합니다.
- **fetchPokemonList 함수**:
  - `fetchPokeApi`를 통해 데이터 가져오기
  - `toPokemonListItem` Mapper를 사용하여 데이터 변환
  - 변환된 배열 반환
- **fetchPokemonDetail 함수**:
  - ID를 기반으로 상세 데이터 가져오기
  - `toPokemonDetailItem` Mapper 사용
  - 변환된 단일 객체 반환

### 파일: src/app/api/pokemon/route.ts
---
설명: 클라이언트 요청을 처리하는 Next.js API Route Handler입니다.
- HTTP GET 메서드 핸들러 구현
- 쿼리 파라미터(`page`, `limit`) 검증
- `fetchPokemonList` 호출
- 변환된 데이터를 JSON 형태로 클라이언트에 응답
- 에러 발생 시 적절한 HTTP 상태 코드와 에러 메시지 반환

### 파일: src/lib/utils/pokeapi.ts
---
설명: PokeAPI 원본 호출을 담당하는 저수준 유틸리티 모듈입니다.
- `fetchPokeApi`: 공통 Fetch 래퍼 함수 (Base URL 설정, 타입입력 등)
- Next.js 서버 환경에서의 캐싱 전략(`fetch`의 `next.revalidate` 옵션) 적용

---

## 아키텍처 흐름
1. **Client** -> `route.ts` (API Request)
2. **route.ts** -> `pokemon.api.ts` (Service Logic)
3. **pokemon.api.ts** -> `pokeapi.ts` (External Data Fetch)
4. **pokeapi.ts** -> `pokemon.api.ts` (Raw Data)
5. **pokemon.api.ts** -> `pokemon.mapper.ts` (Data Transformation)
6. **pokemon.api.ts** -> `route.ts` -> **Client** (DTO Response)