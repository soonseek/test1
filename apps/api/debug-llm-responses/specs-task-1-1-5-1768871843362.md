# 코드 사양 (Code Specification)

**Task ID**: task-1-1-5
**제목**: 에러 핸들링 및 타입 가드 추가
**작성자**: Next.js 14+ Full-Stack Architect

---

## 개요
이 Task는 PokeAPI로부터 데이터를 가져올 때 발생할 수 있는 네트워크 실패나 데이터 무결성 문제를 방지하기 위해 **에러 핸들링 로직**과 **런타임 타입 검증(Type Guard/Zod)**을 추가하는 것을 목적으로 합니다. 이를 통해 애플리케이션의 안정성을 확보하고, 잘못된 데이터가 UI에 렌더링되는 것을 방지합니다.

---

## 파일 사양

### 파일: `src/lib/validations/pokemon.ts`
---
설명: PokeAPI의 응답 데이터 구조를 정의하고, 런타임에 데이터가 해당 구조를 준수하는지 검증하는 Zod 스키마 정의 파일입니다.
- `zod` 라이브러리를 사용하여 스키마 정의
- `PokemonListResponse` 스키마 정의 (count, next, previous, results 배열)
- `results` 내부의 `name`(string)과 `url`(string) 필드 검증 로직 포함
- 타입 추론을 통해 TypeScript 타입과 Zod 스키마를 동기화
- 유효성 검증 실패 시 발생할 에러 타입 정의

### 파일: `src/lib/api/pokemon.ts`
---
설명: PokeAPI 호출 및 에러 핸들링을 담당하는 핵심 로직 파일입니다. (기존 파일 수정)
- `fetchPokemonList` 함수 구현
- **에러 핸들링**: `fetch` 호출 실패 시(HTTP 500, 네트워크 에러 등) 명시적인 `Error` 객체를 throw
- **데이터 검증**: API 응답 받은 즉시 `src/lib/validations/pokemon.ts`의 스키마를 사용하여 `parse()` 또는 `safeParse()` 실행
- 검증 실패 시(데이터 형식이 예상과 다를 경우) `ZodError` 또는 커스텀 에러 throw
- 검증 성공 시 타입이 보장된 데이터 반환
- Next.js의 `fetch` 옵션(`next.revalidate`)은 유지

### 파일: `src/lib/utils/error.ts`
---
설명: 애플리케이션 전역에서 사용할 에러 처리 유틸리티입니다.
- `isPokemonApiError` 함수: 발생한 에러가 네트워크 에러인지, 검증 에러인지 구분하는 타입 가드(Type Guard)
- 사용자에게 표시할 수 있는 에러 메시지 포맷팅 함수

### 파일: `src/app/page.tsx`
---
설명: 메인 페이지 컴포넌트로, API 호출 중 발생하는 에러를 캐치하고 UI에 피드백을 제공합니다.
- Server Component 내부에서 `fetchPokemonList` 호출을 `try-catch` 블록으로 감싸기
- 에러 발생 시 `Error` 컴포넌트 혹은 사용자 친화적인 에러 메시지 UI 렌더링
- 정상 데이터 로드 시 기존 UI 렌더링 로직 수행

---

## 기술적 의사결정 (Note)

1. **Zod 사용**: 단순 `instanceof` 체크나 인터페이스 타입 캐스팅(`as PokemonListResponse`)은 런타임에 안전하지 않습니다. 외부 API이므로 스키마 불일치 가능성을 대비해 **Zod**를 도입하여 런타임 안전성을 확보합니다.
2. **에러 던지기 (Throwing Errors)**: 단순히 `null`을 반환하면 호출한 측에서 "데이터가 없는 것"인지 "에러가 난 것"인지 구분하기 어렵습니다. 명확한 제어 흐름을 위해 에러를 **던지도록(Throw)** 설계합니다.